<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ClarityBrief — Job intake</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f1a2e;
      --panel2:#0c172b;
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.14);
      --text:#e8eefc;
      --muted:rgba(232,238,252,.72);
      --muted2:rgba(232,238,252,.58);
      --brand:#6ee7ff;
      --brand2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius: 16px;
      --radius2: 22px;
      --max: 1100px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 0%, rgba(110,231,255,.18), transparent 55%),
        radial-gradient(900px 700px at 90% 10%, rgba(167,139,250,.14), transparent 55%),
        radial-gradient(900px 700px at 50% 100%, rgba(52,211,153,.08), transparent 60%),
        linear-gradient(180deg, #070c16, #0b1220 55%, #070c16);
    }
    a{color:inherit; text-decoration:none}
    .wrap{max-width:var(--max); margin:0 auto; padding: 22px 18px 64px}

    /* Topbar */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding: 14px 14px;
      border: 1px solid var(--stroke);
      background: rgba(15,26,46,.55);
      backdrop-filter: blur(10px);
      border-radius: var(--radius2);
      box-shadow: 0 10px 30px rgba(0,0,0,.18);
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:750; letter-spacing:.2px;
    }
    .logo{
      width:34px; height:34px; border-radius: 12px;
      background: linear-gradient(135deg, rgba(110,231,255,.95), rgba(167,139,250,.9));
      box-shadow: 0 10px 25px rgba(110,231,255,.12);
      position:relative;
    }
    .logo:after{
      content:"";
      position:absolute; inset:9px;
      border-radius: 10px;
      background: rgba(11,18,32,.70);
      border: 1px solid rgba(255,255,255,.18);
    }
    .nav{
      display:flex; align-items:center; gap:10px;
      font-size: 14px;
      color: var(--muted);
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .pill{
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
    }
    .link{
      color: rgba(232,238,252,.85);
      text-decoration: underline;
      text-underline-offset: 2px;
      font-size: 13px;
    }

    /* Layout */
    .grid{
      margin-top: 16px;
      display:grid;
      grid-template-columns: 1.15fr 0.85fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr}
    }
    .panel{
      background: rgba(15,26,46,.55);
      border: 1px solid var(--stroke);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      padding: 20px;
      backdrop-filter: blur(10px);
    }
    h1{
      margin: 0;
      font-size: 22px;
      letter-spacing: -0.3px;
    }
    .sub{
      margin-top: 8px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.55;
      max-width: 78ch;
    }

    /* Cards + form */
    .card{
      margin-top: 12px;
      padding: 14px;
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    .sectionTitle{
      margin: 0;
      font-size: 13px;
      font-weight: 900;
      letter-spacing: .2px;
      text-transform: uppercase;
      color: rgba(232,238,252,.82);
    }

    .fieldGrid{
      margin-top: 10px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 680px){
      .fieldGrid{grid-template-columns: 1fr}
    }
    .field label{
      display:block;
      font-size: 12px;
      color: rgba(232,238,252,.85);
      font-weight: 800;
      margin-bottom: 6px;
    }
    .input, textarea{
      width:100%;
      padding: 11px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: var(--text);
      outline: none;
      transition: .15s ease;
      font-family: var(--sans);
    }
    textarea{
      min-height: 320px;
      resize: vertical;
      line-height: 1.45;
      font-size: 13px;
    }
    .input:focus, textarea:focus{
      border-color: rgba(110,231,255,.45);
      box-shadow: 0 0 0 4px rgba(110,231,255,.10);
    }
    .hint{
      margin-top: 6px;
      color: var(--muted2);
      font-size: 12px;
      line-height: 1.45;
    }

    .callout{
      margin-top: 12px;
      border-radius: 16px;
      padding: 12px 12px;
      border: 1px solid rgba(110,231,255,.20);
      background:
        radial-gradient(600px 260px at 15% 0%, rgba(110,231,255,.10), transparent 60%),
        rgba(110,231,255,.06);
      color: rgba(232,238,252,.88);
      font-size: 13px;
      line-height: 1.55;
    }
    .callout b{color: rgba(232,238,252,.95)}

    /* Quality checker */
    .qcRow{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-size: 12px;
      white-space: nowrap;
      font-family: var(--mono);
    }
    .dot{
      width:8px; height:8px; border-radius:999px;
      background: var(--warn);
      box-shadow: 0 0 0 4px rgba(251,191,36,.10);
    }
    .dot.good{background: var(--good); box-shadow:0 0 0 4px rgba(52,211,153,.10)}
    .dot.bad{background: var(--bad); box-shadow:0 0 0 4px rgba(251,113,133,.10)}

    .warnBox{
      margin-top: 10px;
      border-radius: 16px;
      padding: 12px 12px;
      border: 1px solid rgba(251,191,36,.25);
      background: rgba(251,191,36,.07);
      color: rgba(232,238,252,.88);
      font-size: 13px;
      line-height: 1.55;
      display:none;
    }
    .warnList{
      margin: 8px 0 0;
      padding-left: 18px;
      color: rgba(232,238,252,.85);
    }

    /* Buttons */
    .ctaRow{
      margin-top: 14px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      justify-content:space-between;
    }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      gap:10px;
      padding: 11px 14px;
      border-radius: 14px;
      border: 1px solid var(--stroke2);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-weight: 850;
      cursor:pointer;
      transition: .15s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.18); background: rgba(255,255,255,.06)}
    .btn:active{transform: translateY(0px)}
    .btn.primary{
      border-color: rgba(110,231,255,.35);
      background: linear-gradient(135deg, rgba(110,231,255,.22), rgba(167,139,250,.18));
      box-shadow: 0 14px 40px rgba(110,231,255,.10);
    }
    .btn.primary:hover{
      border-color: rgba(110,231,255,.50);
      box-shadow: 0 14px 45px rgba(110,231,255,.14);
    }
    .btn.disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none !important;
    }

    .note{
      margin-top: 12px;
      padding: 12px;
      border-radius: 16px;
      border: 1px dashed rgba(255,255,255,.18);
      background: rgba(255,255,255,.02);
      color: var(--muted);
      font-size: 13px;
      line-height: 1.55;
    }

    .footer{
      margin-top: 22px;
      padding-top: 14px;
      border-top: 1px solid rgba(255,255,255,.10);
      display:flex;
      gap: 10px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap: wrap;
      color: var(--muted2);
      font-size: 13px;
    }
    .footer a{color: var(--muted); text-decoration: underline; text-underline-offset: 2px}
    .kbd{
      font-family: var(--mono);
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: rgba(232,238,252,.85);
      white-space:nowrap;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="topbar">
      <div class="brand" aria-label="Product">
        <a href="07_done.html" style="display:flex;align-items:center;gap:10px;">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <div style="display:flex;align-items:baseline;gap:8px;">
              <div style="font-size:15px;">ClarityBrief</div>
              <div style="font-size:12px;color:var(--muted);font-weight:650;">Job intake</div>
            </div>
          </div>
        </a>
      </div>
      <nav class="nav" aria-label="Top navigation">
        <span class="pill" id="trialPill">Trial: Day 1 of 7</span>
        <a class="link" href="07_done.html">Home</a>
        <a class="link" href="09_job_intake.html">Analyze a job</a>
        <a class="link" href="08_preferences.html">Preferences</a>
        <a class="link" href="12_saved_briefs.html">Saved briefs</a>
        <a class="link" href="13_trends.html">Trends</a>
      </nav>
    </header>

    <div class="grid">
      <main class="panel" aria-label="Job intake form">
        <h1>Paste a job description</h1>
        <p class="sub">
          This generates a <b>preview Decision Brief</b> (fit, gaps, uncertainty, strategy) to help you decide whether to apply.
          The system is analytical — not persuasive.
        </p>

        <div class="callout" aria-label="Guardrails">
          <b>Guardrails:</b> We don’t optimize claims. We keep uncertainty explicit. Employers verify truth.
          Use this to calibrate choices — not to fabricate.
        </div>

        <div class="card" aria-label="Optional metadata">
          <div class="sectionTitle">Optional details</div>
          <div class="fieldGrid">
            <div class="field">
              <label for="jobTitle">Role title (optional)</label>
              <input class="input" id="jobTitle" placeholder="e.g., Senior Frontend Engineer" />
              <div class="hint">Helps anchor the brief. You can leave blank.</div>
            </div>
            <div class="field">
              <label for="companyName">Company name (optional)</label>
              <input class="input" id="companyName" placeholder="e.g., StartupX" />
              <div class="hint">Used for context and assumptions, not verification.</div>
            </div>
          </div>
          <div class="fieldGrid">
            <div class="field">
              <label for="jobUrl">Job URL (optional)</label>
              <input class="input" id="jobUrl" placeholder="https://…" />
              <div class="hint">Plain text only. No fetching in this prototype.</div>
            </div>
            <div class="field">
              <label for="notes">Notes / constraints (optional)</label>
              <input class="input" id="notes" placeholder="e.g., must be remote; avoid on-call; salary floor 160k" />
              <div class="hint">We’ll compare this to saved preferences and flag contradictions later.</div>
            </div>
          </div>
        </div>

        <div class="card" aria-label="Job description">
          <div class="sectionTitle">Job description (required)</div>
          <div class="hint" style="margin-top:10px;">
            Tip: Include both responsibilities and requirements if possible. If you only paste a short snippet, uncertainty will increase.
          </div>

          <textarea id="jobRaw" placeholder="Paste the full job description text here…"></textarea>

          <div class="qcRow" aria-label="Inputs quality checker">
            <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
              <span class="chip" id="lenChip"><span class="dot"></span>length: 0 chars</span>
              <span class="chip" id="reqChip"><span class="dot"></span>requirements: unknown</span>
              <span class="chip" id="respChip"><span class="dot"></span>responsibilities: unknown</span>
            </div>
            <span class="pill" id="savedPill">Not saved</span>
          </div>

          <div class="warnBox" id="warnBox">
            <b>Input quality warnings</b>
            <ul class="warnList" id="warnList"></ul>
            <div class="hint" style="margin-top:8px;">
              You can continue, but the Decision Brief will show lower confidence.
            </div>
          </div>

          <div class="ctaRow">
            <div style="display:flex; gap:10px; flex-wrap:wrap;">
              <button class="btn" type="button" onclick="saveDraft(false)">Save draft</button>
              <a class="btn primary" id="genBtn" href="10_job_analyzing.html" onclick="return onGenerateClick(event)">
                Generate Decision Brief preview <span aria-hidden="true">→</span>
              </a>
            </div>
            <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
              <a class="link" href="08_preferences.html">Back</a>
              <a class="link" href="07_done.html">Cancel</a>
            </div>
          </div>

          <div class="note">
            <b>What happens next:</b> We generate a preview brief with: fit snapshot, top gaps, uncertainties, and suggested strategy.
            You remain in control of assumptions and edits.
          </div>
        </div>
      </main>

      <aside class="panel" aria-label="Right rail">
        <div class="card" style="margin-top:0;">
          <div class="sectionTitle">What a “good input” looks like</div>
          <div class="hint" style="margin-top:10px; font-size:13px; line-height:1.6;">
            If possible, paste sections that include:
            <ul style="margin:8px 0 0; padding-left:18px;">
              <li><b>Responsibilities</b> (what you’ll do)</li>
              <li><b>Requirements</b> (skills, years, must-haves)</li>
              <li><b>Nice-to-haves</b> (optional skills)</li>
              <li><b>Comp/location</b> (if included)</li>
            </ul>
          </div>
        </div>

        <div class="card">
          <div class="sectionTitle">Saved preferences snapshot</div>
          <div class="hint" style="margin-top:10px; font-size:13px; line-height:1.6;" id="prefSnap">
            Checking preferences…
          </div>
          <div class="hint" style="margin-top:10px; font-size:12px;">
            Preferences influence feasibility checks (work mode, visa, salary floor).
          </div>
        </div>

        <div class="card">
          <div class="sectionTitle">Boundary</div>
          <div class="hint" style="margin-top:10px; font-size:13px; line-height:1.6;">
            This is decision-support. It helps you understand fit and gaps. It does not generate deceptive content or claims.
          </div>
          <div class="hint" style="margin-top:10px;">
            Keep uncertainty visible. If something is unknown, leave it unknown.
          </div>
        </div>
      </aside>
    </div>

    <footer class="footer" aria-label="Footer">
      <div>
        <div style="font-weight:850; color: rgba(232,238,252,.80);">ClarityBrief</div>
        <div style="margin-top:4px;">Better inputs → better decisions.</div>
      </div>
      <div style="display:flex; gap: 14px; flex-wrap:wrap;">
        <a href="#" onclick="alert('Placeholder: privacy policy'); return false;">Privacy</a>
        <a href="#" onclick="alert('Placeholder: terms'); return false;">Terms</a>
      </div>
    </footer>
  </div>

  <script>
    function getUser(){
      try { return JSON.parse(localStorage.getItem('cb_mock_user') || 'null'); }
      catch { return null; }
    }
    function computeTrialDay(user){
      if(!user?.trialStartISO) return 1;
      const start = new Date(user.trialStartISO);
      const now = new Date();
      const diffDays = Math.max(0, Math.floor((now - start) / (1000*60*60*24)));
      return Math.min((user.trialDays || 7), diffDays + 1);
    }
    function updateTrialPill(){
      const user = getUser();
      const day = computeTrialDay(user);
      const total = user?.trialDays || 7;
      document.getElementById('trialPill').textContent = `Trial: Day ${day} of ${total}`;
    }

    function escapeHtml(s){
      return String(s || '')
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }

    function val(id){ return (document.getElementById(id)?.value || '').trim(); }

    function loadExisting(){
      // Load draft
      const raw = localStorage.getItem('cb_mock_job_raw') || '';
      document.getElementById('jobRaw').value = raw;

      try{
        const metaRaw = localStorage.getItem('cb_mock_job_meta');
        if(metaRaw){
          const m = JSON.parse(metaRaw);
          document.getElementById('jobTitle').value = m.title || '';
          document.getElementById('companyName').value = m.company || '';
          document.getElementById('jobUrl').value = m.url || '';
          document.getElementById('notes').value = m.notes || '';
          if(m.savedAtISO){
            document.getElementById('savedPill').textContent = `Saved: ${new Date(m.savedAtISO).toLocaleString()}`;
          }
        }
      } catch(_) {}

      updateQuality();
    }

    function prefSnapshot(){
      const el = document.getElementById('prefSnap');
      try{
        const raw = localStorage.getItem('cb_mock_preferences');
        if(!raw){
          el.innerHTML = `No saved preferences found. You can still generate a brief, but feasibility checks will have more uncertainty.`;
          return;
        }
        const p = JSON.parse(raw);
        const mode = p.workMode || 'Unknown';
        const visa = p.visa || 'Unknown';
        const salary = p.salaryMin ? `$${String(p.salaryMin).replace(/[^0-9]/g,'')}` : 'Unknown';
        el.innerHTML = `
          Work mode: <span class="kbd">${escapeHtml(mode)}</span><br/>
          Visa: <span class="kbd">${escapeHtml(visa)}</span><br/>
          Salary floor: <span class="kbd">${escapeHtml(salary)}</span>
        `;
      } catch(_){
        el.textContent = 'Could not read preferences.';
      }
    }

    function keywordPresent(text, words){
      const t = text.toLowerCase();
      return words.some(w => t.includes(w));
    }

    function setChip(id, ok, text){
      const el = document.getElementById(id);
      const dot = ok ? 'good' : 'bad';
      el.innerHTML = `<span class="dot ${ok ? 'good' : ''}"></span>${text}`;
      // If unknown state, keep warn color rather than bad
      if(ok === null){
        el.innerHTML = `<span class="dot"></span>${text}`;
      }
    }

    function updateQuality(){
      const txt = val('jobRaw');
      const len = txt.length;

      const lenOk = len >= 1200; // heuristic
      const lenState = len === 0 ? null : lenOk;

      document.getElementById('lenChip').innerHTML =
        `<span class="dot ${lenState === null ? '' : (lenOk ? 'good' : 'bad')}"></span>length: ${len} chars`;

      const hasReq = keywordPresent(txt, ['requirements','required','qualifications','you have','must have','minimum qualifications']);
      const hasResp = keywordPresent(txt, ['responsibilities','what you will do','what you’ll do','you will','role will','duties']);

      setChip('reqChip', txt ? hasReq : null, `requirements: ${txt ? (hasReq ? 'detected' : 'missing') : 'unknown'}`);
      setChip('respChip', txt ? hasResp : null, `responsibilities: ${txt ? (hasResp ? 'detected' : 'missing') : 'unknown'}`);

      // Warnings
      const warns = [];
      if(len > 0 && len < 500) warns.push('Text is very short. Paste the full job description for better confidence.');
      if(len >= 500 && len < 1200) warns.push('Text is somewhat short. If possible, include responsibilities + requirements sections.');
      if(txt && !hasReq) warns.push('No clear “Requirements / Qualifications” section detected. This increases uncertainty.');
      if(txt && !hasResp) warns.push('No clear “Responsibilities / Duties” section detected. This increases uncertainty.');

      const box = document.getElementById('warnBox');
      const list = document.getElementById('warnList');
      if(warns.length){
        box.style.display = 'block';
        list.innerHTML = warns.map(w => `<li>${escapeHtml(w)}</li>`).join('');
      } else {
        box.style.display = 'none';
        list.innerHTML = '';
      }

      // Enable/disable generate button
      const gen = document.getElementById('genBtn');
      if(!txt){
        gen.classList.add('disabled');
        gen.style.pointerEvents = 'none';
        gen.style.opacity = '.55';
      } else {
        gen.classList.remove('disabled');
        gen.style.pointerEvents = 'auto';
        gen.style.opacity = '1';
      }
    }

    function saveDraft(showToast){
      const raw = val('jobRaw');
      const meta = {
        savedAtISO: new Date().toISOString(),
        title: val('jobTitle') || null,
        company: val('companyName') || null,
        url: val('jobUrl') || null,
        notes: val('notes') || null
      };

      try { localStorage.setItem('cb_mock_job_raw', raw); } catch(_) {}
      try { localStorage.setItem('cb_mock_job_meta', JSON.stringify(meta)); } catch(_) {}

      document.getElementById('savedPill').textContent = `Saved: ${new Date(meta.savedAtISO).toLocaleString()}`;
      if(showToast) alert('Draft saved (mock).');
    }

    function onGenerateClick(e){
      const raw = val('jobRaw');
      if(!raw){
        e.preventDefault();
        alert('Please paste a job description first.');
        return false;
      }
      // Save before navigating
      saveDraft(false);

      // (Optional) also store quick quality signals
      const quality = {
        computedAtISO: new Date().toISOString(),
        lengthChars: raw.length,
        hasRequirements: keywordPresent(raw, ['requirements','required','qualifications','must have','minimum qualifications']),
        hasResponsibilities: keywordPresent(raw, ['responsibilities','what you will do','you will','duties'])
      };
      try { localStorage.setItem('cb_mock_job_quality', JSON.stringify(quality)); } catch(_) {}
      return true;
    }

    // init
    updateTrialPill();
    prefSnapshot();
    loadExisting();

    // live updates
    document.getElementById('jobRaw').addEventListener('input', updateQuality);
  </script>
</body>
</html>
